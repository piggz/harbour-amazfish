clickable_minimum_required: 8.6.0

prebuild: git submodule update --init
kill: harbour-amazfish
ignore_review_errors: true

builder: cmake
build_args:
- -DFLAVOR=uuitk
- -DCMAKE_CXX_FLAGS=-I${QTMPRIS_LIB_INSTALL_DIR}/usr/include/${ARCH_TRIPLET}/qt5/\ -I${QTMPRIS_LIB_INSTALL_DIR}/usr/include/${ARCH_TRIPLET}/qt5/MprisQt
- -DCMAKE_EXE_LINKER_FLAGS=-L${QTMPRIS_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/
env_vars:
  PKG_CONFIG_PATH: ${QTMPRIS_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/pkgconfig:${NEMO_QML_PLUGIN_DBUS_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/pkgconfig

dependencies_target:
- libkdb3-driver-sqlite
- qml-module-org-kde-bluezqt
- libkdb3-dev
- libkf5contacts-dev
- libkf5archive-dev
- libkf5coreaddons-dev
- libdbus-1-dev
- libtelepathy-qt5-dev
- libusermetricsinput1-dev
- libpulse-dev

libraries:
  qtmpris:
    src_dir: 3rdparty/qtmpris
    prebuild:
    - mkdir -p ${ROOT}/3rdparty
    - git -C ${SRC_DIR} pull || git clone https://github.com/sailfishos/qtmpris ${SRC_DIR}
    builder: qmake

  nemo-qml-plugin-dbus:
    src_dir: 3rdparty/nemo-qml-plugin-dbus
    prebuild:
    - mkdir -p ${ROOT}/3rdparty
    - git -C ${SRC_DIR} pull || git clone https://github.com/sailfishos/nemo-qml-plugin-dbus ${SRC_DIR}
    builder: qmake

  maplibre-native:
    src_dir: 3rdparty/maplibre-native
    prebuild:
    - mkdir -p ${ROOT}/3rdparty
    - rm -rf ${ROOT}/3rdparty/maplibre-native
    - git clone -b v3.0.0 --recursive --shallow-submodules --depth 1 https://github.com/maplibre/maplibre-native-qt.git ${SRC_DIR}
    - cd ${ROOT}/3rdparty/maplibre-native && git apply --verbose ${ROOT}/click/0002-Fixes-for-compilation-on-SFOS.patch
    - cd ${ROOT}/3rdparty/maplibre-native/vendor/maplibre-native && git apply --verbose ${ROOT}/click/0004-fix-double-move-callback.patch
    builder: cmake
    build_args:
    - -DMLN_QT_WITH_WIDGETS=OFF
    - -DMLN_QT_WITH_LOCATION=OFF
    - -DMLN_QT_WITH_INTERNAL_ICU=ON
    - -DMLN_WITH_WERROR=OFF
  mapbox-gl-qml:
    src_dir: 3rdparty/mapbox-gl-qml
    prebuild:
    - mkdir -p ${ROOT}/3rdparty
    - rm -rf ${ROOT}/3rdparty/mapbox-gl-qml
    - git clone -b 3.1.1 --recursive --shallow-submodules --depth 1  https://github.com/rinigus/mapbox-gl-qml.git ${SRC_DIR}
    builder: cmake
    build_args:
    - -DCMAKE_CXX_STANDARD=14
    - -DCMAKE_CXX_FLAGS=-I${MAPLIBRE_NATIVE_LIB_INSTALL_DIR}/include\ -L${MAPLIBRE_NATIVE_LIB_INSTALL_DIR}/lib


install_lib:
- ${NEMO_QML_PLUGIN_DBUS_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/libnemodbus.so*
- ${QTMPRIS_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/libmpris-qt5.so*
- ${MAPLIBRE_NATIVE_LIB_INSTALL_DIR}/lib/libQMapLibre.so*
- /usr/lib/${ARCH_TRIPLET}/libKDb3.so*
- /usr/lib/${ARCH_TRIPLET}/libKF5BluezQt.so*
install_data:
  /usr/lib/${ARCH_TRIPLET}/qt5/plugins/kdb3: bin
install_qml:
- ${NEMO_QML_PLUGIN_DBUS_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/qt5/qml/Nemo/DBus
- ${QTMPRIS_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/qt5/qml/org/nemomobile/mpris
- ${MAPBOX_GL_QML_LIB_INSTALL_DIR}/usr/lib/${ARCH_TRIPLET}/qt5/qml/MapboxMap
- ${MAPLIBRE_NATIVE_LIB_INSTALL_DIR}/lib/libQMapLibre.so*
- /usr/lib/${ARCH_TRIPLET}/qt5/qml/org/kde/bluezqt
